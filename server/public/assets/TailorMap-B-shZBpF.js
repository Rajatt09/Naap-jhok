import{r as i,j as e,a as N}from"./index-D1PmyStg.js";import{c as C,l as x,d as j,e as L,f as M,M as k,T as y,b as v,L as f,u as b,_ as P,w}from"./geosearch-EkPBADqJ.js";import{g as S}from"./tailors-ClCv5F0q.js";import{g as O}from"./locations-CZUDh4h-.js";function R(a,r,s){r.center!==s.center&&a.setLatLng(r.center),r.radius!=null&&r.radius!==s.radius&&a.setRadius(r.radius)}const I=C(function({center:r,children:s,...t},l){const c=new x.Circle(r,t);return j(c,L(l,{overlayContainer:c}))},R),E=M(function(r,s){const t=new x.Popup(r,s.overlayContainer);return j(t,s)},function(r,s,{position:t},l){i.useEffect(function(){const{instance:o}=r;function p(u){u.popup===o&&(o.update(),l(!0))}function h(u){u.popup===o&&l(!1)}return s.map.on({popupopen:p,popupclose:h}),s.overlayContainer==null?(t!=null&&o.setLatLng(t),o.openOn(s.map)):s.overlayContainer.bindPopup(o),function(){var d;s.map.off({popupopen:p,popupclose:h}),(d=s.overlayContainer)==null||d.unbindPopup(),s.map.removeLayer(o)}},[r,s,l,t])});delete f.Icon.Default.prototype._getIconUrl;f.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png"});function T(){const a=b();return i.useEffect(()=>{const r=new P,s=new w({provider:r,style:"bar",autoComplete:!0,autoCompleteDelay:250,showMarker:!1,retainZoomLevel:!1,animateZoom:!0,keepResult:!0});return a.addControl(s),()=>a.removeControl(s)},[a]),null}function U(a,r,s,t){const c=(s-a)*Math.PI/180,o=(t-r)*Math.PI/180,p=Math.sin(c/2)**2+Math.cos(a*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(o/2)**2;return 2*6371*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))}const W=()=>{const[a,r]=i.useState(null),[s,t]=i.useState([]),[l,c]=i.useState([]),[o,p]=i.useState(0),[h,u]=i.useState(!0),d=i.useRef();return i.useEffect(()=>{(async()=>{try{const n=await O();r(n);const m=await S();t(m),c(m)}catch(n){console.error(n)}finally{u(!1)}})()},[]),i.useEffect(()=>{if(!a)return;if(o===0)return c(s);const n=s.filter(m=>U(a.lat,a.lng,m.location.lat,m.location.lng)<=o);c(n)},[o,s,a]),h?e.jsx("div",{className:"mp-loading",children:"Loading map..."}):e.jsxs("div",{className:"mp-wrapper",children:[e.jsxs("div",{className:"mp-header",children:[e.jsxs("div",{className:"mp-location-info",children:[e.jsx("div",{className:"mp-location-icon",children:"ðŸ“"}),e.jsxs("div",{className:"mp-location-details",children:[e.jsx("span",{className:"mp-location-label",children:"Your Location"}),e.jsx("span",{className:"mp-coordinates",children:a?`${a.lat.toFixed(4)}, ${a.lng.toFixed(4)}`:"Loading..."})]})]}),e.jsxs("div",{className:"mp-controls",children:[e.jsxs("div",{className:"mp-control-group",children:[e.jsx("label",{htmlFor:"radius-select",className:"mp-control-label",children:"ðŸŽ¯ Search Range:"}),e.jsxs("select",{id:"radius-select",className:"mp-select",value:o,onChange:n=>p(+n.target.value),children:[e.jsx("option",{value:0,children:"All Tailors"}),e.jsx("option",{value:2,children:"2 km"}),e.jsx("option",{value:5,children:"5 km"}),e.jsx("option",{value:10,children:"10 km"}),e.jsx("option",{value:15,children:"15 km"})]})]}),e.jsxs("div",{className:"mp-tailor-count",children:["ðŸ‘¥ ",l.length," tailors found"]})]})]}),e.jsxs(k,{center:a,zoom:13,scrollWheelZoom:!0,className:"mp-map-container",whenCreated:n=>d.current=n,children:[e.jsx(y,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Â© OSM contributors"}),e.jsx(T,{}),o>0&&e.jsx(I,{center:a,radius:o*1e3,pathOptions:{color:"#4f46e5",fillColor:"#4f46e5",fillOpacity:.1,weight:2}}),e.jsx(v,{position:a,icon:f.divIcon({className:"mp-user-marker",iconSize:[16,16],html:'<div class="mp-user-marker-inner"></div>'})}),l.map(n=>e.jsx(v,{position:n.location,eventHandlers:{click:()=>{d.current.setView(n.location,15,{animate:!0})}},children:e.jsx(E,{className:"mp-popup",maxWidth:200,minWidth:180,children:e.jsxs("div",{className:"mp-popup-body",children:[e.jsxs("div",{className:"mp-popup-header",children:[e.jsx("img",{src:n.avatar,className:"mp-popup-img",alt:"Tailor"}),e.jsx("div",{className:"mp-popup-info",children:e.jsx("h5",{className:"mp-popup-name",children:n.userId.name})})]}),e.jsxs("div",{className:"mp-popup-services",children:[e.jsxs("span",{className:"mp-services-label",children:[n.area," ",e.jsx("br",{})]}),e.jsx("h4",{children:"Services:"}),e.jsxs("div",{className:"mp-services-tags",children:[n.servicesOffered.slice(0,2).map((m,g)=>e.jsx("span",{className:"mp-service-tag",children:m},g)),n.servicesOffered.length>2&&e.jsxs("span",{className:"mp-service-tag mp-more-tag",children:["+",n.servicesOffered.length-2," more"]})]})]}),e.jsx(N,{to:`/tailor/${n._id}`,children:e.jsx("button",{className:"mp-popup-btn",children:"Place Order"})})]})})},n._id))]})]})};export{W as default};
