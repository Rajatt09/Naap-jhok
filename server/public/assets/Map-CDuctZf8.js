import{r as g,j as a}from"./index-D1PmyStg.js";import{M as h,T as f,u as x,_ as j,w as v,a as L,b as y,L as d}from"./geosearch-EkPBADqJ.js";import{s as w,b as k}from"./tailors-ClCv5F0q.js";import{g as m}from"./locations-CZUDh4h-.js";delete d.Icon.Default.prototype._getIconUrl;d.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png"});function M({setSelectedPosition:t,setAreaName:e}){const o=x();return g.useEffect(()=>{const s=new j,l=new v({provider:s,style:"bar",autoComplete:!0,autoCompleteDelay:250,showMarker:!1,retainZoomLevel:!1,animateZoom:!0,keepResult:!0});return o.addControl(l),o.on("geosearch/showlocation",i=>{const{x:c,y:n,label:r}=i.location,p={lat:n,lng:c};t(p),e(r),o.setView(p,14)}),()=>{o.removeControl(l)}},[o,t,e]),null}function E({selectedPosition:t,setSelectedPosition:e,setAreaName:o}){return L({click(s){e(s.latlng),u(s.latlng,o)}}),t===null?null:a.jsx(y,{position:t,draggable:!0,eventHandlers:{dragend:s=>{const l=s.target.getLatLng();e(l),u(l,o)}}})}async function u(t,e){try{const s=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t.lat}&lon=${t.lng}`)).json();e(s.display_name||"Unknown area")}catch(o){console.error("Error fetching area name:",o)}}const S=({center:t})=>{const[e,o]=g.useState({lat:t.lat,lng:t.lng}),[s,l]=g.useState(t.area||""),[i,c]=g.useState(""),n=async()=>{const r={location:{lat:e.lat,lng:e.lng},area:s};try{await w(r),c("Location saved successfully!"),setTimeout(()=>c(""),3e3)}catch(p){console.error("Error saving location:",p),c("Failed to save location!"),setTimeout(()=>c(""),3e3)}};return a.jsxs("div",{className:"map-wrapper",children:[a.jsxs(h,{center:{lat:t.lat,lng:t.lng},zoom:14,scrollWheelZoom:!0,className:"map-container",children:[a.jsx(f,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),a.jsx(M,{setSelectedPosition:o,setAreaName:l}),a.jsx(E,{selectedPosition:e,setSelectedPosition:o,setAreaName:l})]}),e&&a.jsxs("div",{className:"location-details",children:[a.jsx("h4",{children:"Selected Area:"}),a.jsx("p",{className:"area-name",children:s||"Not selected"}),a.jsxs("div",{className:"coordinates",children:[a.jsxs("span",{children:["Lat: ",e.lat.toFixed(6)]}),"    ",a.jsxs("span",{children:["Long: ",e.lng.toFixed(6)]})]})]}),e&&a.jsx("button",{className:"save-btn",onClick:n,children:"Save Location"}),i&&a.jsx("div",{className:"save-message",children:i})]})},U=()=>{const[t,e]=g.useState({lat:28.6139,lng:77.209}),[o,s]=g.useState(!0);return g.useEffect(()=>{(async()=>{var i,c;try{const n=await k();if((i=n==null?void 0:n.location)!=null&&i.lat&&((c=n==null?void 0:n.location)!=null&&c.lng))e({lat:n.location.lat,lng:n.location.lng,area:n.area});else{const r=await m();e({lat:r.lat,lng:r.lng})}}catch(n){console.error("Error getting location:",n.message);try{const r=await m();e({lat:r.lat,lng:r.lng})}catch(r){console.error("Error getting user's location:",r.message)}}finally{s(!1)}})()},[]),o?a.jsx("p",{children:"Loading map..."}):a.jsx("div",{children:a.jsx(S,{center:t})})};export{U as default};
