import{f as D,b as C,u as A,r as n,j as e,L as E}from"./index-D1PmyStg.js";import{u as T,a as L}from"./index.esm-BIul7JyP.js";import{a as B}from"./tailors-ClCv5F0q.js";import{c as H}from"./orders-lTb7AU2X.js";const G=()=>{const[O]=D(),p=C(),{currentUser:R}=A(),m=O.get("tailorId"),[l,S]=n.useState(null),[F,x]=n.useState(!0),[h,f]=n.useState(!1),[d,o]=n.useState(null),{register:a,control:I,handleSubmit:q,watch:M,formState:{errors:r}}=T({defaultValues:{items:[{description:"",fabric:"",measurements:"",price:0}],deliveryOption:"pickup",paymentMethod:"cash"}}),{fields:u,append:k,remove:$}=L({control:I,name:"items"}),j=M("items").reduce((i,s)=>i+(parseFloat(s.price)||0),0);n.useEffect(()=>{(async()=>{if(!m){o("No tailor selected"),x(!1);return}try{const{tailor:s,error:t}=await B(m);t?o(t):S(s)}catch{o("Failed to load tailor information")}finally{x(!1)}})()},[m]);const w=async i=>{try{f(!0),o(null);const s={tailorId:m,items:i.items.map(c=>({...c,price:parseFloat(c.price)})),deliveryOption:i.deliveryOption,paymentMethod:i.paymentMethod,price:j},t=await H(s);p(`/order/${t._id}`)}catch{o("Failed to place order. Please try again.")}finally{f(!1)}};return F?e.jsx(E,{}):d&&!l?e.jsxs("div",{className:"error-container",role:"alert",children:[e.jsx("h2",{children:"Error"}),e.jsx("p",{children:d}),e.jsx("button",{onClick:()=>p("/"),className:"btn btn-primary",children:"Back to Home"})]}):e.jsx("div",{className:"order-form-page",children:e.jsxs("div",{className:"order-form-container",children:[e.jsxs("div",{className:"order-form-header",children:[e.jsx("h1",{children:"Place Order"}),l&&e.jsxs("div",{className:"tailor-info",children:[e.jsx("img",{src:l.avatar,alt:l.userId.name,className:"tailor-avatar"}),e.jsxs("div",{children:[e.jsx("h3",{children:l.userId.name}),e.jsx("p",{children:l.shopAddress})]})]})]}),d&&e.jsx("div",{className:"alert alert-error",role:"alert",children:d}),e.jsxs("form",{onSubmit:q(w),className:"order-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Order Items"}),u.map((i,s)=>{var t,c,y,v,b,N,g,P;return e.jsxs("div",{className:"order-item",children:[e.jsxs("div",{className:"item-header",children:[e.jsxs("h3",{children:["Item ",s+1]}),u.length>1&&e.jsx("button",{type:"button",onClick:()=>$(s),className:"btn btn-error btn-sm",children:"Remove"})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:`items.${s}.description`,children:"Description *"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"e.g., Men's Shirt, Women's Dress",...a(`items.${s}.description`,{required:"Description is required"})}),((c=(t=r.items)==null?void 0:t[s])==null?void 0:c.description)&&e.jsx("p",{className:"input-error",children:r.items[s].description.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:`items.${s}.fabric`,children:"Fabric *"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"e.g., Cotton, Silk, Polyester",...a(`items.${s}.fabric`,{required:"Fabric is required"})}),((v=(y=r.items)==null?void 0:y[s])==null?void 0:v.fabric)&&e.jsx("p",{className:"input-error",children:r.items[s].fabric.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:`items.${s}.price`,children:"Price (₹) *"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"form-control",placeholder:"0.00",...a(`items.${s}.price`,{required:"Price is required",min:{value:0,message:"Price must be positive"}})}),((N=(b=r.items)==null?void 0:b[s])==null?void 0:N.price)&&e.jsx("p",{className:"input-error",children:r.items[s].price.message})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:`items.${s}.measurements`,children:"Measurements *"}),e.jsx("textarea",{className:"form-control",rows:"3",...a(`items.${s}.measurements`,{required:"Measurements are required"})}),((P=(g=r.items)==null?void 0:g[s])==null?void 0:P.measurements)&&e.jsx("p",{className:"input-error",children:r.items[s].measurements.message})]})]},i.id)}),e.jsx("button",{type:"button",onClick:()=>k({description:"",fabric:"",measurements:"",price:0}),className:"btn btn-outline",children:"Add Another Item"})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Delivery & Payment"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Delivery Option *"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",value:"pickup",...a("deliveryOption",{required:"Please select delivery option"})}),e.jsx("span",{children:"Pickup from Shop"})]}),e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",value:"home_delivery",...a("deliveryOption",{required:"Please select delivery option"})}),e.jsx("span",{children:"Home Delivery"})]})]}),r.deliveryOption&&e.jsx("p",{className:"input-error",children:r.deliveryOption.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payment Method *"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",value:"cash",...a("paymentMethod",{required:"Please select payment method"})}),e.jsx("span",{children:"Cash"})]}),e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",value:"upi",...a("paymentMethod",{required:"Please select payment method"})}),e.jsx("span",{children:"UPI"})]})]}),r.paymentMethod&&e.jsx("p",{className:"input-error",children:r.paymentMethod.message})]})]})]}),e.jsxs("div",{className:"order-summary",children:[e.jsx("h2",{children:"Order Summary"}),e.jsxs("div",{className:"summary-content",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Items:"}),e.jsx("span",{children:u.length})]}),e.jsxs("div",{className:"summary-row total",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{children:["₹",j.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:()=>p(-1),className:"btn btn-outline",disabled:h,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:h||j===0,children:h?"Placing Order...":"Place Order"})]})]})]})})};export{G as default};
